---
title: "Title"
author: "Ishani Makwana, Henry Hirsch and Ei Tanaka"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r init, include=F}
rm(list=ls())
library(readr)
library(reshape2)
library(corrplot)
library(dplyr)
library(usmap)
library(ggplot2)
library(gridExtra)
rm(list=ls())
```

```{r setup, include=FALSE}
# Some of common RMD options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
knitr::opts_chunk$set(warning = F, results = "hide", message = F)
# Can globally set option for number display format.
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
```

## Introduction (need edited)
**(need edited)**

```{r init_data}
# Importing a geographic health disparities data set

urlfile = 'https://raw.githubusercontent.com/eitanaka/DATS6101_Project1_Team2/main/dataset/geographic_health_disparities.csv'

geo_health_df <- read_csv(url(urlfile))
```

## Summary Statistics(need edited)
```{r}
# Create data frame by state
data_by_state <- split(geo_health_df, geo_health_df$StateAbbr)
```

### Depression by state(need edited)
```{r EDA_basicstats_Depression}
summary_by_stateD <- lapply(data_by_state, function(x) summary(x$Data_Value.DEPRESSION))
head(summary_by_stateD,3)
tail(summary_by_stateD,3)

sd_by_stateD<- lapply(data_by_state, function(x) sd(x$Data_Value.DEPRESSION))
head(summary_by_stateD,3)
tail(summary_by_stateD,3)

# Convert mean_by_state to a data frame
mean_by_state_DEPRESSION <- lapply(data_by_state, function(x) mean(x$Data_Value.DEPRESSION))
mean_df_DEPRESSION <-data.frame(State = names(mean_by_state_DEPRESSION), Mean_Depression=unlist(mean_by_state_DEPRESSION))

# # Create a bar chart of the mean depression values by state
# barplot(mean_df_DEPRESSION$Mean_Depression, names.arg = mean_df_DEPRESSION$State, xlab = "State", ylab = "Mean Depression Value", col = "red", main = "Mean Depression Values by State")

# Create a new maps object
mean_df_DEPRESSION["fips"] <- fips(mean_df_DEPRESSION$State)

plot_usmap(data=mean_df_DEPRESSION, values="Mean_Depression", labels = TRUE) +
  scale_fill_continuous(low = "white", high = "red", guide = FALSE) +
  scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
  ggtitle("Mean Depression by State") +
  guides(fill = guide_colorbar(title = "Mean %", 
                                title.position = "top", 
                                title.hjust = 0.5, 
                                label.position = "left",
                                label.hjust = 0.5))
```

### Mental health by state(need edited)
```{r echo=T, eval=T, include=T, results='markup'}
summary_by_stateM <- lapply(data_by_state, function(x) summary(x$Data_Value.MHLTH))
head(summary_by_stateM,3)
tail(summary_by_stateM,3)

sd_by_stateM <- lapply(data_by_state, function(x) sd(x$Data_Value.MHLTH))
head(sd_by_stateM,3)
tail(sd_by_stateM,3)

# Convert mean_by_state to a data frame
mean_by_state_MHLTH <- lapply(data_by_state, function(x) mean(x$Data_Value.MHLTH))
mean_df_MHLTH <- data.frame(State = names(mean_by_state_MHLTH), Mean_MHLTH = unlist(mean_by_state_MHLTH))

# # Create a bar chart of the mean depression values by state
# barplot(mean_df_MHLTH$Mean_MHLTH, names.arg = mean_df_MHLTH$State, xlab = "State", ylab = "Mean Mental Value", col = "yellow", main = "Mean mental Values by State")

# Create a new maps object
mean_df_MHLTH["fips"] <- fips(mean_df_MHLTH$State)

plot_usmap(data=mean_df_MHLTH, values="Mean_MHLTH", labels = TRUE) +
  scale_fill_continuous(low = "white", high = "green", guide = FALSE) +
  scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
  ggtitle("Mean Mental Health by State") +
  guides(fill = guide_colorbar(title = " Mean %", 
                                title.position = "top", 
                                title.hjust = 0.5, 
                                label.position = "left",
                                label.hjust = 0.5))
```

### Sleep by state(need edited)
```{r echo=T, eval=T, include=T, results='markup'}
summary_by_stateS <- lapply(data_by_state, function(x) summary(x$Data_Value.SLEEP))
head(summary_by_stateS,3)
tail(summary_by_stateS,3)

sd_by_stateS <- lapply(data_by_state, function(x) sd(x$Data_Value.SLEEP))
head(sd_by_stateS,3)
tail(sd_by_stateS,3)

# Convert mean_by_state to a data frame
mean_by_state_SLEEP <- lapply(data_by_state, function(x) mean(x$Data_Value.SLEEP))
mean_df_SLEEP <- data.frame(State = names(mean_by_state_SLEEP), Mean_Sleep = unlist(mean_by_state_SLEEP))

# # Create a bar chart of the mean depression values by state
# barplot(mean_df_SLEEP$Mean_Sleep, names.arg = mean_df_SLEEP$State, xlab = "State", ylab = "Mean SLEEP Value", col = "blue", main = "Mean SLEEP Values by State")

# Create a new maps object
mean_df_SLEEP["fips"] <- fips(mean_df_SLEEP$State)

plot_usmap(data=mean_df_SLEEP, values="Mean_Sleep", labels = TRUE) +
  scale_fill_continuous(low = "white", high = "purple", guide = FALSE) +
  scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
  ggtitle("Mean Sleep by State") +
  guides(fill = guide_colorbar(title = "Mean %", 
                                title.position = "top", 
                                title.hjust = 0.5, 
                                label.position = "left",
                                label.hjust = 0.5))
```

```{r}
summary_by_stateS <- lapply(data_by_state, function(x) summary(x$Data_Value.LPA))
head(summary_by_stateS,3)
tail(summary_by_stateS,3)

sd_by_stateS <- lapply(data_by_state, function(x) sd(x$Data_Value.LPA))
head(sd_by_stateS,3)
tail(sd_by_stateS,3)

# Convert mean_by_state to a data frame
mean_by_state_LPA <- lapply(data_by_state, function(x) mean(x$Data_Value.LPA))
mean_df_LPA <- data.frame(State = names(mean_by_state_LPA), Mean_LPA = unlist(mean_by_state_LPA))

# Create a new maps object
mean_df_LPA["fips"] <- fips(mean_df_LPA$State)

plot_usmap(data=mean_df_LPA, values="Mean_LPA", labels = TRUE) +
  scale_fill_continuous(low = "white", high = "cyan", guide = FALSE) +
  scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
  ggtitle("Mean Lack of Physial Activity by State") +
  guides(fill = guide_colorbar(title = "Mean %", 
                                title.position = "top", 
                                title.hjust = 0.5, 
                                label.position = "left",
                                label.hjust = 0.5))
```


### Corelation between each disease by state

```{r}
# Compute the correlation matrix
# Merge the first two data frames by the "id" column
mean_df <- merge(merge(mean_df_DEPRESSION, mean_df_MHLTH, by=c("State", "fips")), mean_df_SLEEP, by=c("State", "fips"))
mean_df <- merge(mean_df, mean_df_LPA, by=c("State", "fips"))
head(mean_df)
```


### Comparing the mean values of all three variables using boxplot. 

```{r}
# Create a data frame with mean values for each variable


# # Create a box plot
# ggplot(data, aes(x = variable, y = value, fill = variable)) +
#   geom_boxplot() +
# #  facet_wrap(~ variable, ncol=4)
#   geom_jitter(width = 0.2, size = 1, alpha = 0.5) +
#   scale_fill_manual(values = c("blue", "red", "green", "yellow")) +
#   labs(title = "Mean Values of Depression, Sleep, LPA and Mental Health")

# ^ figure out how to change green to yellow
```


This code will create a table showing the mean, median, and standard deviation for each variable (depression, sleep, and mental health) across all states, grouped by state names or FIPS codes. You can compare the results to see how each variable varies across different states.

```{r}
# create mean dataframe for all four conditions
colnames(mean_df)[3:6] <- c("Depression", "MHLTH", "Sleep", "LPA")

# create national correlation matrix
cor_matrix <- cor(mean_df[ , c("Depression", "MHLTH", "Sleep", "LPA")])

# create national correlation heat map
cor_heat_map <- corrplot(cor_matrix, method = "color")
cor_heat_map

# create mixed national correlation heat map
mixed_cor_heat_map <- corrplot.mixed(cor_matrix)
mixed_cor_heat_map

# # create correlation list of matrices for states
# cor_by_state <- lapply(data_by_state, function(state_data) {
#   cor(state_data[c("Data_Value.DEPRESSION", "Data_Value.MHLTH", "Data_Value.SLEEP")])
# })
# 
# # create state correlation matrix
# dep_mhlth.cor <- sapply(cor_by_state, function(state) state[1,2])
# dep_slp.cor <- sapply(cor_by_state, function(state) state[1,3])
# mhlth.slp.cor <- sapply(cor_by_state, function(state) state[2,3])
# 
# state_cor_df <- data.frame(state = mean_df$State, dep_mhlth.cor, dep_slp.cor, mhlth.slp.cor)
# state_cor_df["fips"] <- fips(state_cor_df$state)
# state_cor_df <- select(state_cor_df, "state", "fips", "dep_mhlth.cor", "dep_slp.cor", "mhlth.slp.cor")
```

```{r}
# us correlation maps
# plot_usmap(data=state_cor_df, values="dep_mhlth.cor", labels = TRUE) +
#   scale_fill_continuous(low = "white", high = "orange", guide = FALSE) +
#   scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
#   ggtitle("Correlation Betweeen Depression and Mental Health") +
#   guides(fill = guide_colorbar(title = "Correlation", 
#                                 title.position = "top", 
#                                 title.hjust = 0.5, 
#                                 label.position = "left",
#                                 label.hjust = 0.5))
# 
# plot_usmap(data=state_cor_df, values="dep_slp.cor", labels = TRUE) +
#   scale_fill_continuous(low = "white", high = "purple", guide = FALSE) +
#   scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
#   ggtitle("Correlation Betweeen Depression and Sleep") +
#   guides(fill = guide_colorbar(title = "Correlation", 
#                                 title.position = "top", 
#                                 title.hjust = 0.5, 
#                                 label.position = "left",
#                                 label.hjust = 0.5))
# 
# plot_usmap(data=state_cor_df, values="mhlth.slp.cor", labels = TRUE) +
#   scale_fill_continuous(low = "white", high = "green", guide = FALSE) +
#   scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
#   ggtitle("Correlation Betweeen Mental Health and Sleep") +
#   guides(fill = guide_colorbar(title = "Correlation", 
#                                 title.position = "top", 
#                                 title.hjust = 0.5, 
#                                 label.position = "left",
#                                 label.hjust = 0.5))
```


```{r}
#Linear regression
# data frame is named 'mean_df'
Linear_reg <- lm(Depression ~ Sleep + LPA, data = mean_df)
summary(Linear_reg)


Linear_reg <- lm(MHLTH ~ Sleep + LPA, data = mean_df)
summary(Linear_reg)

```
 we failed to reject depression and there is a significant test for mental health . that means mental health is effected by sleep and LPA. 

```{r}
# create scatter plots
# sleep scatter plot
ggplot(mean_df, aes(x = Sleep)) +
  geom_point(aes(y = Depression, color = "Depression")) +
  geom_point(aes(y = MHLTH, color = "MHLTH")) +
  scale_color_manual(name = "Health Outcomes", values = c("Depression" = "red", "MHLTH" = "green")) +
  labs(x = "% Lacking Sleep", 
       y = "% With Health Outcomes",
       title = "Correlation Between Lack of Sleep and Health Outcomes")


# lpa scatter plot
ggplot(mean_df, aes(x = LPA)) +
  geom_point(aes(y = Depression, color = "Depression")) +
  geom_point(aes(y = MHLTH, color = "MHLTH")) +
  scale_color_manual(name = "Health Outcomes", values = c("Depression" = "red", "MHLTH" = "green")) +
  labs(x = "% Lacking Physical Activity", 
       y = "% With Health Outcomes",
       title = "Correlation Between Lack of Physical Activity and Health Outcomes")
```





